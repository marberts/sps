
R version 4.1.2 (2021-11-01) -- "Bird Hippie"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(sps)
> 
> set.seed(4321)
> 
> # Corner cases
> prop_allocation(1:5, 0)
1 
0 
> prop_allocation(1:3, 0, 1:3)
1 2 3 
0 0 0 
> prop_allocation(1:5, 5)
1 
5 
> prop_allocation(rep(1, 10), 4, rep(letters[1], 10))
a 
4 
> 
> # Simple allocations
> prop_allocation(rep(1, 10), 4, rep(letters[1:2], 5))
a b 
2 2 
> prop_allocation(rep(c(1, 10), 5), 4, rep(letters[1:2], 5))
a b 
0 4 
> prop_allocation(rep(c(1, 10), 5), 4, rep(letters[1:2], 5), min = 1)
a b 
1 3 
> prop_allocation(rep(c(1, 10), 5), 4, rep(letters[1:2], 5), min = 2)
a b 
2 2 
>
> # Multiple iterations
> prop_allocation(c(1, 1, 1, 1, 1, 1, 1, 10, 10, 10), 5, rep(letters[1:2], c(7, 3)))
a b 
2 3 
> prop_allocation(c(1, 1, 1, 1, 1, 1, 9, 9, 100, 100), 5, rep(letters[1:3], c(6, 2, 2)))
a b c 
1 2 2 
> prop_allocation(c(1, 1, 1, 1, 1, 1, 9, 9, 100, 100), 5, rep(letters[1:3], c(6, 2, 2)), method = "Adams")
a b c 
1 2 2
> 
> # Allocation for each stratum should add up to total sample size
> all(replicate(50, sum(prop_allocation(rlnorm(50), 10, sample(letters, 50, TRUE))) == 10))
[1] TRUE
> all(replicate(50, sum(prop_allocation(rlnorm(50), 10, sample(letters, 50, TRUE), method = "D'Hondt")) == 10))
[1] TRUE
> all(replicate(50, sum(prop_allocation(rlnorm(50), 10, sample(letters, 50, TRUE), method = "Webster")) == 10))
[1] TRUE
> all(replicate(50, sum(prop_allocation(rlnorm(50), 10, sample(letters, 50, TRUE), method = "Imperiali")) == 10))
[1] TRUE
> all(replicate(50, sum(prop_allocation(rlnorm(50), 10, sample(letters, 50, TRUE), method = "Huntington-Hill")) == 10))
[1] TRUE
> all(replicate(50, sum(prop_allocation(rlnorm(50), 10, sample(letters, 50, TRUE), method = "Danish")) == 10))
[1] TRUE
> all(replicate(50, sum(prop_allocation(rlnorm(50), 10, sample(letters, 50, TRUE), method = "Adams")) == 10))
[1] TRUE
> all(replicate(50, sum(prop_allocation(rlnorm(50), 10, sample(letters, 50, TRUE), method = "Dean")) == 10))
[1] TRUE
>
> # Alabama paradox
> prop_allocation(rep(1, 14), 10, rep(1:3, c(6, 6, 2)))
1 2 3 
4 4 2 
> prop_allocation(rep(1, 14), 11, rep(1:3, c(6, 6, 2)))
1 2 3 
5 5 1 
> 
> prop_allocation(rep(1, 14), 10, rep(1:3, c(6, 6, 2)), method = "D'Hondt")
1 2 3 
5 4 1 
> prop_allocation(rep(1, 14), 11, rep(1:3, c(6, 6, 2)), method = "D'Hondt")
1 2 3 
5 5 1 
> 
> # Checks for error messages
> try(prop_allocation(c(-1, 1), 5))
Error in prop_allocation(c(-1, 1), 5) : 
  'x' must be a strictly positive and finite numeric vector
> try(prop_allocation(1:5, -1))
Error in prop_allocation(1:5, -1) : 
  'N' must be a positive and finite number
> try(prop_allocation(1:4, 5))
Error in prop_allocation(1:4, 5) : 
  sample size 'N' is greater than or equal to population size
> try(prop_allocation(1:4, 2, min = 3))
Error in prop_allocation(1:4, 2, min = 3) : 
  minimal allocation is larger than 'N'
> 
> proc.time()
   user  system elapsed 
  0.406   0.164   0.512 
